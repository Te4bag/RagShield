# RagShield 

**A document auditing system that bridges the trust gap in Retrieval-Augmented Generation (RAG)**

RagShield provides sentence-level post-hoc attribution and visual trust visualization by combining high-speed inference via Groq with local Natural Language Inference (NLI). Every claim generated by your RAG system is verified against source documents to prevent hallucinations.

---

##  The Core Concept

Most RAG systems suffer from **"Blind Trust"**â€”they assume the LLM uses retrieved context correctly. RagShield acts as a defensive layer that audits every sentence the LLM generates against source material using NLI logic:

- ðŸŸ¢ **Supported (Entailment)**: The claim is directly backed by the source corpus
- ðŸŸ¡ **Partially Supported (Neutral)**: The claim is plausible but lacks direct textual evidence
- ðŸ”´ **Unsupported (Contradiction)**: The claim is a hallucination or conflicts with the source

---

##  Tech Stack

| Component | Technology |
|-----------|-----------|
| **LLM Engine** | [Groq API](https://groq.com/) (Llama 3 / Mixtral) for low-latency RAG |
| **Vector Database** | [ChromaDB](https://www.trychroma.com/) (Local persistent storage) |
| **Embeddings** | all-MiniLM-L6-v2 via Sentence-Transformers |
| **Verification** | Local NLI Model (DeBERTa-v3) |
| **Frontend** | [Streamlit](https://streamlit.io/) for "Traffic Light" trust rendering |

---

##  Repository Structure

```
rag-shield/
â”œâ”€â”€ ingest/              # Unified PDF & TXT extraction with length-guards
â”œâ”€â”€ index/               # Recursive chunking & ChromaDB management
â”œâ”€â”€ rag/                 # Retrieval logic and Groq API orchestration
â”œâ”€â”€ verify/              # Sentence-splitting & NLI scoring logic
â”œâ”€â”€ ui/                  # Streamlit dashboard & hover-citations
â”œâ”€â”€ demo/                # Example documents (ICD-10 Manuals, Research Papers)
â”œâ”€â”€ requirements.txt     # Project dependencies
â””â”€â”€ README.md
```

---

##  Setup & Installation

### 1. Clone the Repository

```bash
git clone https://github.com/your-username/rag-shield.git
cd rag-shield
```

### 2. Set Up Environment Variables

Create a `.env` file in the root directory:

```env
GROQ_API_KEY=your_api_key_here
PROTOCOL_BUFFERS_PYTHON_IMPLEMENTATION=python
```

### 3. Install Dependencies

```bash
pip install -r requirements.txt
```

### 4. Prepare Your Documents

Place your PDFs/TXT files in `demo/example_docs/` directory. The indexing will be handled automatically when you upload documents through the Streamlit interface.

---

##  Usage

### Running the Streamlit Dashboard

```bash
streamlit run ui/app.py
```

Navigate to `http://localhost:8501` in your browser to:
- Upload documents
- Ask questions via RAG
- View sentence-level trust scores with color-coded verification

### Programmatic Usage

```python
from rag.retriever import retrieve_context
from verify.nli_checker import verify_claims

# Retrieve relevant context
context = retrieve_context(query="What is the ICD-10 code for diabetes?")

# Generate response via Groq
response = generate_answer(query, context)

# Verify each sentence
verification_results = verify_claims(response, context)
```

---

##  Attribution Logic

RagShield implements a two-stage verification process:

1. **Sentence Splitting**: The LLM output is decomposed into individual sentences
2. **NLI Verification**: For each sentence:
   - Performs secondary semantic search to find the most relevant chunk
   - Uses a DeBERTa-v3 NLI model to compare:
     - **Hypothesis**: The generated sentence
     - **Premise**: The retrieved source chunk
   - Assigns a trust score (Entailment/Neutral/Contradiction)

This ensures that every claim shown to the user is anchored in verifiable source material.

---

##  Example Output

**Query**: "What are the symptoms of Type 2 Diabetes?"

**RAG Response** (with trust scores):

> ðŸŸ¢ Type 2 diabetes commonly presents with increased thirst and frequent urination.  
> ðŸŸ¡ Patients may experience gradual weight loss over several months.  
> ðŸ”´ The condition is primarily caused by vitamin D deficiency.

---

## ðŸ”§ Configuration

Customize chunking, retrieval, and verification parameters in `config.yaml`:

```yaml
ingestion:
  chunk_size: 600
  chunk_overlap: 60

retrieval:
  top_k: 3

models:
  embeddings: "all-MiniLM-L6-v2"
  generator: "llama3-8b-8192"
  nli_model: "cross-encoder/nli-deberta-v3-small"

verification:
  entailment_threshold: 0.85
```

